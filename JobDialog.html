<!DOCTYPE html>
<html>

<head>
    <title>Kloudio Google sheets addon</title>
    <?!=include( 'Stylesheet'); ?>
        <style>
            .uk-accordion-title {
                font-size: 15px;
            }
            .sidebar {
                -moz-box-sizing: border-box;
                box-sizing: border-box;
                overflow-y: auto;
                position: absolute;
                width: 100%;
            }
            .branding-below {
                bottom: 25px;
                top: 0;
            }
            .bottom,
            .bottom-left,
            .button-bar {
                bottom: 0;
                position: absolute;
                border-top: 1px solid #efefef;
                background: #fff;
            }
            .action-bar {
                margin-top: 20px;
                position: relative;
            }
        </style>
</head>

<body ng-app="app">
    <div class="app-loading">
        <p align="center">
            <img src="https://s3-us-west-1.amazonaws.com/kloudioforgoogle/rotate.gif">
        </p>
    </div>

    <div ng-controller="schCtrl" class="app-wrapper" style="display:none;">
        <div class="sidebar branding-below">
            <div ng-if="isLoading">
                <p align="center">
                    <img src="https://s3-us-west-1.amazonaws.com/kloudioforgoogle/rotate.gif">
                </p>
            </div>
            <div ng-if="!isLoading && !!!schedule">
                <p align="left">There is no refresh schedule setup for this sheet. Setup now!</p>
            </div>
            <div ng-if="!isLoading && !isOfflineEnabled" class="uk-alert-danger">
                <p align="left">Offline access to Google sheets has to be enabled in order to schedule auto refresh. Please enable Offline Access in your Kloudio Account Settings.</p>
            </div>  
            <div ng-if="!isLoading && isOfflineEnabled && isNewSchedule && isOverLimit" class="uk-alert-danger">
                <p align="left">You have reached the limit of {{currentUser.jobLimit}} scheduled refreshes. Please consider upgrading your plan for more scheduling more refreshes.</p>
            </div>              
            <div class="uk-container" ng-if="!isLoading && schedule && isOfflineEnabled && (!isNewSchedule || isNewSchedule && !isOverLimit)">
                <div class="uk-margin uk-form-controls">
                    <label class="uk-form-label">
                        <input type="checkbox" class="uk-checkbox" ng-model="schedule.enabled" ng-true-value="true" ng-false-value="false">&nbsp;Enable Scheduled Refresh for the current sheet</label>
                </div>
                <form class="uk-form-stacked">
                    <div class="uk-margin">
                        <label class="uk-form-label">Select Frequency</label>
                        <div class="uk-form-controls">
                            <select class="uk-select uk-form-small" id="frequency_select" ng-model="schedule.frequency" ng-disabled="!schedule.enabled" ng-change="frequencyChanged($event)">
                                <option ng-repeat="fval in frequencies" value="{{fval}}">{{fval}}</option>
                            </select>
                        </div>
                    </div>

                    <div class="uk-margin" ng-if="schedule.frequency == 'Hourly'">
                        <label class="uk-form-label">Select Minute</label>
                        <div class="uk-form-controls">
                            <select class="uk-select uk-form-small" id="hourly_min" ng-model="schedule.minute" ng-disabled="!schedule.enabled">
                                <option ng-repeat="min in ['00','15','30','45']" value="{{min}}">{{min}}</option>
                            </select>
                        </div>
                    </div>

                    <div class="uk-margin" ng-if="schedule.frequency == 'Minute'">
                        <label class="uk-form-label">Select Interval</label>
                        <div class="uk-form-controls">
                            <select class="uk-select uk-form-small" id="min_interval" ng-model="schedule.minute" ng-disabled="!schedule.enabled">
                                <option ng-repeat="min in ['5','15','30','45']" value="{{min}}">{{min}}</option>
                            </select>
                        </div>
                    </div>

                    <div class="uk-margin" ng-if="schedule.frequency == 'Weekly'">
                        <label class="uk-form-label">Select Day</label>
                        <div class="uk-form-controls">
                            <select class="uk-select uk-form-small" id="day_of_week" ng-model="schedule.day" ng-disabled="!schedule.enabled">
                                <option ng-repeat="dow in [{name:'Sun',indx: 0},{name:'Mon', indx:1},{name:'Tue',indx:2},{name:'Wed',indx:3},{name:'Thu',indx:4},{name:'Fri',indx:5},{name:'Sat',indx:6}]" value="{{dow.indx}}">{{dow.name}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="uk-margin" ng-if="schedule.frequency == 'Monthly'">
                        <div class="uk-form-label">Select Date</div>
                        <div class="uk-form-controls">
                            <select class="uk-select uk-form-small" id="day_of_month" style="" ng-model="schedule.day" ng-disabled="!schedule.enabled">
                                <option ng-repeat="dom in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]" value="{{dom}}">{{dom}}</option>
                            </select>
                        </div>
                    </div>

                    <label class="uk-form-label" ng-if="schedule.frequency == 'Daily' || schedule.frequency == 'Weekly' || schedule.frequency == 'Monthly'">Select Time</label>
                    <div class="uk-margin uk-grid-small" ng-if="schedule.frequency == 'Daily' || schedule.frequency == 'Weekly' || schedule.frequency == 'Monthly'" uk-grid>

                        <div class="" style="display:inline-block;width:80px;">
                            <select class="uk-select uk-form-small" id="hval_select" style="" ng-model="schedule.hour" ng-disabled="!schedule.enabled" placeholder="Hour">
                                <option ng-repeat="hval in [1,2,3,4,5,6,7,8,9,10,11,12]" value="{{hval}}">{{hval}}</option>
                            </select>
                        </div>

                        <div style="display:inline-block;width:80px;">
                            <select class="uk-select uk-form-small" id="mval_select" style="" ng-model="schedule.minute" ng-disabled="!schedule.enabled" placeholder="Min">
                                <option ng-repeat="mval in ['00','15','30','45']" value="{{mval}}">{{mval}}</option>
                            </select>
                        </div>

                        <div style="display:inline-block;width:80px;">
                            <select class="uk-select ampm uk-form-small" id="am_pm_select" style="" ng-model="schedule.am_pm" ng-disabled="!schedule.enabled" placeholder="Am/Pm">
                                <option ng-repeat="p in ['AM','PM']" value="{{p}}">{{p}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="uk-margin" ng-if="schedule.frequency == 'Daily' || schedule.frequency == 'Weekly' || schedule.frequency == 'Monthly'">
                        <div class="uk-form-label">Select Timezone</div>
                        <div class="uk-form-controls">
                            <select class="uk-select uk-form-small" id="tz_select" style="" ng-model="schedule.timezone" ng-disabled="!schedule.enabled">
                                <option ng-repeat="tz in timezones" value="{{tz.name}}">{{tz.desc}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="uk-margin uk-form-controls">
                        <label class="uk-form-label">
                            <input type="checkbox" class="uk-checkbox" ng-model="schedule.email_on_success" ng-true-value="true" ng-false-value="false">&nbsp;Email when sheet is refreshed</label>
                    </div>
                    <br/>
                    <br/>
                </form>
            </div>
        </div>

        <div class="sidebar bottom" ng-if="!isLoading && isOfflineEnabled">
            <button class="uk-button uk-button-small uk-button-primary" id="updateSchBtn" ng-click="updateSchedule();" ng-disabled="inProgress || !(!isLoading && schedule && isOfflineEnabled && (!isNewSchedule || isNewSchedule && !isOverLimit))" style="margin-top:20px">
                <div ng-if="inProgress" uk-spinner></div>{{inProgress ? ' Please wait...' : 'Save'}}
            </button>
            <button class="uk-button uk-button-small" onClick="google.script.host.close();" style="margin-top:20px">Cancel</button>
            <div class="uk-alert-danger" uk-alert ng-if="errors !==''">
               <p>{{errors}}</p>
            </div>            
        </div>
    </div>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/kloudioassets/gsheets/js/uikit.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.2/angular.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.js"></script>
    <?!=include( 'JobJS'); ?>
        <script>
            $(document).ready(function() {
                setTimeout(function() {
                    $('.app-loading').css('display', 'none');
                    $('.app-wrapper').css('display', 'block');
                }, 100);

            });
        </script>
</body>

</html>