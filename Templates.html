<!DOCTYPE html>
<html>

<head>
    <title>Kloudio Google sheets addon</title>
    <?!=include( 'Stylesheet'); ?>
        <style>
            .uk-accordion-title {
                font-size: 14px;
            }
            .sidebar {
                -moz-box-sizing: border-box;
                box-sizing: border-box;
                overflow-y: auto;
                position: absolute;
                width: 100%;
            }
            .branding-below {
                bottom: 40px;
                top: 0;
            }
            .bottom,
            .bottom-left,
            .button-bar {
                bottom: 0;
                position: absolute;
                border-top: 1px solid #efefef;
                background: #fff;
            }
            .logo {
                width: 150px;
                height: 53px;
            }
            .no-spin::-webkit-inner-spin-button {
  -webkit-appearance: none;
}

        </style>
</head>

<body ng-app="app">
    <div class="app-loading">
        <p align="center">
            <img src="https://s3-us-west-1.amazonaws.com/kloudioforgoogle/rotate.gif">
        </p>
    </div>
    <div class="app-wrapper sidebar branding-below" style="display:none;"> 
        <div ng-controller="TemplatesCtrl">
           <? if(trialText !== '') { ?>
              <div class="<?= bgColor ?>" uk-alert ng-if="!isLoading">
                  <p align="center"><?=trialText ?></p>
                  <p align="center"><a href="<?=upgradeUrl ?>" target="_blank" class="uk-button uk-button-small uk-button-primary"><?=upgradeText?></a></p>
              </div>
          <? } ?>
                 <div uk-alert ng-if="!isLoading && (!!!myTemplates || myTemplates.length ==0)" style="font-size:0.85em;">
                    You have not created any templates in Kloudio yet. 
                    <a href="<?=templateUrl?>" target="_blank">Create Template</a>
                 </div>
                 <div ng-if="isLoading">
                    <p align="center">
                       <img src="https://s3-us-west-1.amazonaws.com/kloudioforgoogle/rotate.gif">
                    </p>
                 </div>
                 <div ng-if="myTemplates && myTemplates.length > 0 && !templateInserted">
                      <div style="background: #efefef;padding:10px 5px;vertical-align: middle;margin-bottom: 10px;">
                            <h5 style="padding:0;vertical-align: middle;margin:0"><span style="font-weight:300">Select a Template</span></h5>
                       </div>
                    <form class="uk-form">
                        <fieldset class="uk-fieldset">
                            <div class="uk-container">
                                <div class="field">
                                    <select ng-model="selected.template" class="uk-select uk-form-small">
                                        <option ng-value="tmpl.value" ng-repeat="tmpl in myTemplates">{{tmpl.value.templateName}}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="uk-margin uk-container">
                                <button class="uk-button uk-button-primary" ng-click="insertTemplate()" ng-disabled="!!!selected.template || inProgress">
                                    <div ng-if="inProgress" uk-spinner></div>{{inProgress? ' Please wait' : 'Insert Template'}}
                                </button>
                            </div>
                        </fieldset>
                    </form>
                </div>
                 <div ng-if="selected.template && templateInserted">
                      <div style="background: #efefef;padding:10px 5px;vertical-align: middle;margin-bottom: 10px;">
                            <h5 style="padding:0;vertical-align: middle;margin:0"><span style="font-weight:300">Schedule Uploads</span></h5>
                       </div>
                      <div class="uk-container">
                        <form class="uk-form-stacked" ng-if="currentUser && currentUser.googleAuthCode">
                            <div class="uk-margin">
                                <label class="uk-form-label">Select Frequency</label>
                                <div class="uk-form-controls">
                                    <select class="uk-select uk-form-small" id="frequency_select" ng-model="schedule.frequency" ng-change="scheduleChanged($event)" ng-disabled="!schedule.enabled">
                                        <option ng-repeat="fval in ['Minute','Hourly','Daily', 'Weekly', 'Monthly']" value="{{fval}}">{{fval}}</option>
                                    </select>
                                </div>
                            </div>

                            <div class="uk-margin" ng-if="schedule.frequency == 'Hourly'">
                                <label class="uk-form-label">Select Minute</label>
                                <div class="uk-form-controls">
                                    <select class="uk-select uk-form-small" id="hourly_min" ng-model="schedule.minute" ng-disabled="!schedule.enabled">
                                        <option ng-repeat="min in ['00','15','30','45']" value="{{min}}">{{min}}</option>
                                    </select>
                                </div>
                            </div>

                            <div class="uk-margin" ng-if="schedule.frequency == 'Minute'">
                                <label class="uk-form-label">Select Interval</label>
                                <div class="uk-form-controls">
                                    <select class="uk-select uk-form-small" id="min_interval" ng-model="schedule.minute" ng-disabled="!schedule.enabled">
                                        <option ng-repeat="min in ['5','15','30','45']" value="{{min}}">{{min}}</option>
                                    </select>
                                </div>
                            </div>

                            <div class="uk-margin" ng-if="schedule.frequency == 'Weekly'">
                                <label class="uk-form-label">Select Day</label>
                                <div class="uk-form-controls">
                                    <select class="uk-select uk-form-small" id="day_of_week" ng-model="schedule.day" ng-disabled="!schedule.enabled">
                                        <option ng-repeat="dow in [{name:'Sun',indx: 0},{name:'Mon', indx:1},{name:'Tue',indx:2},{name:'Wed',indx:3},{name:'Thu',indx:4},{name:'Fri',indx:5},{name:'Sat',indx:6}]" value="{{dow.indx}}">{{dow.name}}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="uk-margin" ng-if="schedule.frequency == 'Monthly'">
                                <div class="uk-form-label">Select Date</div>
                                <div class="uk-form-controls">
                                    <select class="uk-select uk-form-small" id="day_of_month" style="" ng-model="schedule.day" ng-disabled="!schedule.enabled">
                                        <option ng-repeat="dom in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]" value="{{dom}}">{{dom}}</option>
                                    </select>
                                </div>
                            </div>

                            <label class="uk-form-label" ng-if="schedule.frequency == 'Daily' || schedule.frequency == 'Weekly' || schedule.frequency == 'Monthly'">Select Time</label>
                            <div class="uk-margin uk-grid-small" ng-if="schedule.frequency == 'Daily' || schedule.frequency == 'Weekly' || schedule.frequency == 'Monthly'" uk-grid>

                                <div class="" style="display:inline-block;width:70px;">
                                    <select class="uk-select uk-form-small" id="hval_select" style="" ng-model="schedule.hour" ng-disabled="!schedule.enabled" placeholder="Hour">
                                        <option ng-repeat="hval in [1,2,3,4,5,6,7,8,9,10,11,12]" value="{{hval}}">{{hval}}</option>
                                    </select>
                                </div>

                                <div style="display:inline-block;width:70px;">
                                    <select class="uk-select uk-form-small" id="mval_select" style="" ng-model="schedule.minute" ng-disabled="!schedule.enabled" placeholder="Min">
                                        <option ng-repeat="mval in ['00','15','30','45']" value="{{mval}}">{{mval}}</option>
                                    </select>
                                </div>

                                <div style="display:inline-block;width:70px;">
                                    <select class="uk-select uk-form-small ampm uk-form-width-small" id="am_pm_select" style="" ng-model="schedule.am_pm" ng-disabled="!schedule.enabled" placeholder="Am/Pm">
                                        <option ng-repeat="p in ['AM','PM']" value="{{p}}">{{p}}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="uk-margin" ng-if="schedule.frequency == 'Daily' || schedule.frequency == 'Weekly' || schedule.frequency == 'Monthly'">
                                <div class="uk-form-label">Select Timezone</div>
                                <div class="uk-form-controls">
                                    <select class="uk-select uk-form-small" id="tz_select" style="" ng-model="schedule.timezone" ng-disabled="!schedule.enabled">
                                        <option ng-repeat="tz in timezones" value="{{tz.name}}">{{tz.desc}}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="uk-margin uk-form-controls">
                                <label class="uk-form-label">
                                    <input type="checkbox" class="uk-checkbox" ng-model="schedule.email_on_success" ng-true-value="true" ng-false-value="false">&nbsp;Email when sheet is refreshed</label>
                            </div>
                            <div class="uk-margin">
                                <button class="uk-button uk-button-primary" id="updateSchBtn" ng-click="updateSchedule();" ng-disabled="schRunning">
                                    <div ng-if="schRunning" uk-spinner></div>{{schRunning ? ' Please wait...' : 'Save'}}
                                </button>
                                <button class="uk-button" onClick="google.script.host.close();">Cancel</button>
                                <div class="uk-alert-danger" uk-alert ng-if="errors !==''">
                                     <p>{{errors}}</p>
                                </div>                                  
                            </div>
                        </form>  
                     </div>
                </div>                
        </div>
    </div>
    <div class="sidebar bottom">
        <p align="center" style="margin:0;padding:0">
            <img class="logo" src="https://s3.amazonaws.com/kloudioassets/images/kloudioleft.png">
        </p>    
    </div>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/kloudioassets/gsheets/js/uikit.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.2/angular.min.js"></script>
    <?!=include( 'TemplateJS'); ?>
        <script>
            $(document).ready(function() {
                $('.app-wrapper').fadeIn(1000);
                $('.app-loading').css('display', 'none');
            });
        </script>

</body>

</html>